<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="data:image/png;base64,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" rel="icon" type="image/x-icon">
    <link rel="stylesheet" href="css/style.css">
    <script src="src/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Mood Tracker</title>
</head>
<body>

<?php
	//call file to connect server moodtracker
	include ("mood-header.php");
	?>

<?php 
  
  // Start the session on your graph.php page
  session_start();
  
  // Get the logged-in user's username from the session
  $username = $_SESSION['username'];
  
  // Connect to the database
  $connect = new mysqli('localhost', 'root', '', 'moodtracker');
  
  // Modify your SQL query to fetch only the data for the logged-in user
  $query = $connect->query("SELECT mood, amount, username, date FROM chart WHERE username = '$username' GROUP BY date");

// Create arrays to store mood, amount, and date data
$moods = [];
$amount = [];
$dates = [];

foreach ($query as $data) {
    $moods[] = $data['mood'];
    $amount[] = $data['amount'];
    $dates[] = $data['date']; // Store the date in an array
}
  

?>
    
<?php

if(isset($_POST['save_radio']))
{
    $mood = $_POST['mood'];
    $amount= $_POST['amount'];
    $u= $_POST['username'];
    $formatted_date = $_POST['date'];

    $query = "INSERT INTO chart (mood,amount, username, date) VALUES ('$mood', '$amount', '$u',$formatted_date)";
    $query_run = mysqli_query($connect, $query);

    if($query_run)
    {
        $_SESSION['status'] = "Submitted";
        header("Location: track.php");
    }
    else {
        $_SESSION['status'] = "Try Again";
        header("Location: track.php");
    }
}

$moodColors = [
  'Happy' => 'rgba(255, 99, 132, 0.2)', // Yellow
  'Sad' => 'rgba(255, 159, 64, 0.2)',    // Blue
  'Excited' => 'rgba(255, 205, 86, 0.2)',   // Pink
  'Anxious' => 'rgba(75, 192, 192, 0.2)', // Red
  'Worried' => 'rgba(153, 102, 255, 0.2)'   // Purple
];

$borderColors = [
  'Happy' => 'rgb(255, 99, 132)', // Yellow
  'Sad' => 'rgb(255, 159, 64)',    // Blue
  'Excited' => 'rgb(255, 205, 86)',   // Pink
  'Anxious' => 'rgb(75, 192, 192)', // Red
  'Worried' => 'rgb(153, 102, 255)'   // Purple
];

?>
<header>
        <nav class="header__nav">
            <div class="header__logo">
            <a href="moodtracker-1.php"><h4 data-aos="fade-down">Mood Tracker</h4></a>
                <div class="header__logo-overlay"></div>
            </div>

            <ul class="header__menu" data-aos="fade-down">
                <li class="dropdown">
                    <a class="dropbtn">Mood</a>
                    <div class="dropdown-content">
                        <a href="track.php">Track Mood</a>
                        <a href="graph.php">Mood Graph</a>
                        <a href="journal.php">Journaling</a>
                    </div>
                </li>
                <li>
                  <a href="journal-history.php">Journals</a>
                </li>
                <li>
                    <a href="about.php">About Us</a>
                </li>
                <li>
                  <a href="signout.php"><img src="assets/log-out.png" width="20" height="20"></a>
                </li>
            </ul>
        </nav>
    </header>

  <div style="display: flex; justify-content: center;">
    <div style="width: 1000px; padding: 80px;">
    <h1 class="heading"> Your Moods <span>Graph</span></h1>
    <canvas id="myChart"></canvas>
  </div>
</div>

<?php
// Calculate mood count
$moodCount = array_count_values($moods);

// Calculate total moods
$totalMoods = count($moods);

function calculatePercentages() {
  global $moods, $moodCount, $totalMoods;

  $percentageColors = [
    'Happy' => 'rgba(255, 99, 132, 0.5)',
    'Sad' => 'rgba(255, 159, 64, 0.5)',
    'Excited' => 'rgba(255, 205, 86, 0.5)',
    'Anxious' => 'rgba(75, 192, 192, 0.5)',
    'Worried' => 'rgba(153, 102, 255, 0.5)'
  ];

  $barPercentages = '';

  foreach ($moodCount as $mood => $count) {
    $percentage = (($count / $totalMoods) * 100);
    $barPercentages .= '<div class="percentage-bar-item" style="background-color: ' . $percentageColors[$mood] . '; width: ' . $percentage . '%;">' . $mood . '</div>';
  }

  return $barPercentages;
}

// Call the function to calculate and display both percentages
$barPercentages = calculatePercentages();
?>

<div class="percentage-bar">
  <h3>Mood Percentages</h3>
  <div class="percentage-bar-items">
    <?php
      $moodNames = array_keys($moodColors);
      foreach ($moodNames as $moodName) {
        $percentage = ($moodCount[$moodName] / $totalMoods) * 100;
        echo '<div class="percentage-bar-item" style="background-color: ' . $moodColors[$moodName] . '; width: ' . $percentage . '%;">';
        echo $moodName . ' (' . number_format($percentage, 2) . '%)';
        echo '</div>';
      }
    ?>
  </div>
</div>
<div class="legend">
  <h3>The Color Represent:</h3>
  <div class="legend-item">
    <div class="legend-color" style="background-color: rgba(255, 99, 132, 0.2);"></div>
    <p>Happy</p>
  </div>
  <div class="legend-item">
    <div class="legend-color" style="background-color: rgba(255, 159, 64, 0.2);"></div>
    <p>Sad</p>
  </div>
  <div class="legend-item">
    <div class="legend-color" style="background-color: rgba(255, 205, 86, 0.2);"></div>
    <p>Excited</p>
  </div>
  <div class="legend-item">
    <div class="legend-color" style="background-color: rgba(75, 192, 192, 0.2);"></div>
    <p>Anxious</p>
  </div>
  <div class="legend-item">
    <div class="legend-color" style="background-color: rgba(153, 102, 255, 0.2);"></div>
    <p>Worried</p>
  </div>
</div>

<div class="action-legend">
  <h3>Actions for High Emotions:</h3>
  <div class="action-item">
    <div class="action-color" style="background-color: rgba(255, 159, 64, 0.2);"></div>
    <p>Sad - Take a break, talk to a friend, or engage in activities you enjoy.</p>
  </div>
  <div class="action-item">
    <div class="action-color" style="background-color: rgba(75, 192, 192, 0.2);"></div>
    <p>Anxious - Practice deep breathing, mindfulness, or consider seeking professional help.</p>
  </div>
  <div class="action-item">
    <div class="action-color" style="background-color: rgba(153, 102, 255, 0.2);"></div>
    <p>Worried - Break down tasks into manageable steps, seek support, or focus on positive aspects.</p>
  </div>
</div>


<script>
  // === include 'setup' then 'config' above ===
const labels = <?php echo json_encode($dates) ?>;
const data = {
    labels: <?php echo json_encode($dates) ?>,
    datasets: [{
      label: 'Your Moods Chart',
      data: <?php echo json_encode($amount) ?>,
      backgroundColor: <?php
        $backgroundColorArray = [];
        foreach ($moods as $mood) {
          $backgroundColorArray[] = $moodColors[$mood];
        }
        echo json_encode($backgroundColorArray);
      ?>,
      borderColor: <?php
        $borderColorArray = [];
        foreach ($moods as $mood) {
          $borderColorArray[] = $borderColors[$mood];
        }
        echo json_encode($borderColorArray);
      ?>,
      borderWidth: 1
    }]
};


  const config = {
    type: 'bar',
    data: data,
    options: {
      scales: {
        x: {
          title: {
            display: true,
            text: 'Date',
          },
        },
        y: {
          beginAtZero: true,
        },
      },
    },
  };

  var myChart = new Chart(
    document.getElementById('myChart'),
    config
  );

  function calculatePercentages() {
  const moodData = <?php echo json_encode($moods) ?>;
  const totalMoods = moodData.length;

  const moodCount = moodData.reduce((count, mood) => {
    count[mood] = (count[mood] || 0) + 1;
    return count;
  }, {});

  const percentageData = Object.keys(moodCount).map((mood) => {
    const percentage = ((moodCount[mood] / totalMoods) * 100).toFixed(2);
    return `${mood}: ${percentage}%`;
  });

  const barPercentages = document.getElementById('bar-percentages');
  barPercentages.innerHTML = '';

  // Create bars for each mood category
  Object.keys(moodCount).forEach((mood) => {
    const percentage = ((moodCount[mood] / totalMoods) * 100).toFixed(2);

    const bar = document.createElement('div');
    bar.className = 'percentage-bar-item';
    bar.style.width = percentage + '%';
    bar.innerText = mood;

    barPercentages.appendChild(bar);
  });
}

// Call the function to calculate and display both percentages
calculatePercentages();


</script>
</body>
<style>
  /* Add your CSS styles here */
  .li a, .dropbtn {
  display: inline-block;
  color: black;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
}

li a:hover, .dropdown:hover .dropbtn {
  background-color: var(--primary-color);
}

li.dropdown {
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.dropdown-content a:hover {background-color: #f1f1f1;}

.dropdown:hover .dropdown-content {
  display: block;
}

.legend {
  margin: 20px auto;
  padding: 20px;
  border: 1px solid #ccc;
  background-color: #f9f9f9;
  max-width: 300px;
  text-align: center;
}

.legend h3 {
  font-size: 24px;
  margin-bottom: 15px;
}

.legend-items {
  display: flex;
  flex-direction: column; /* Display items in a column layout */
  align-items: center;
}

.legend-item {
  display: flex;
  align-items: center;
  margin: 10px 0;
}

.legend-color {
  width: 30px;
  height: 30px;
  margin-right: 15px;
}

.percentage-bar {
  text-align: center;
  padding: 10px;
  background-color: #f9f9f9;
  border: 1px solid #ccc;
  border-radius: 10px;
  margin-top: 20px;
  max-width: 300px;
  margin: 20px auto;
}

.percentage-bar h3 {
  font-size: 24px;
  margin-bottom: 15px;
}

.percentage-bar-items {
  display: flex;
  flex-direction: column; /* Display items in a column layout */
  align-items: left;
  margin: 10px 0;
}

.percentage-bar-item {
  color: var(--black);
  padding: 5px 10px;
  border-radius: 5px;
  background-color: #007BFF;
  margin-bottom: 10px;
}

.percentage-bar-item:hover {
  background-color: #0056b3;
  cursor: pointer;
  transition: background-color 0.3s;
}

/* Style for the action legend */
.action-legend {
 margin: 20px auto;
  padding: 20px;
  border: 1px solid #ccc;
  background-color: #f9f9f9;
  max-width: 300px;
  text-align: center;
}

.action-legend h3 {
  font-size: 18px;
  margin-bottom: 10px;
}

.action-item {
  margin-bottom: 8px;
}

.action-color {
  width: 20px;
  height: 20px;
  display: inline-block;
  margin-right: 8px;
}


  </style>
</html>